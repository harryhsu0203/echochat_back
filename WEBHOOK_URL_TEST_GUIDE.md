# 用戶專屬 Webhook URL 功能測試指南

## 功能概述

我們已經實作了類似 seachat 的用戶專屬 webhook URL 功能，現在您可以測試這個功能了。

## 測試步驟

### 1. 進入 LINE 設定頁面
- 在您的 app 中導航到「Line 設定」頁面

### 2. 查看 Webhook 設定區塊
- 向下滾動到「Webhook 設定」區塊
- 您應該會看到「您的專屬端點」區塊

### 3. 測試功能
- **自動載入**：頁面載入時會自動生成您的專屬 webhook URL
- **手動測試**：點擊「測試生成」按鈕重新生成 URL
- **重新整理**：點擊重新整理按鈕（🔄）重新生成
- **複製功能**：點擊「複製」按鈕將 URL 複製到剪貼簿

## 預期結果

### 成功情況
您應該會看到：
```
您的專屬端點
https://ai-chatbot-umqm.onrender.com/api/webhook/line/{您的用戶ID}

[複製] 用戶 ID: {您的用戶ID}

• 基於您的用戶 ID 動態生成
• 支援 AI 聊天回應
• 自動認證和授權

[測試生成]
```

### 調試信息
在 Xcode 控制台中，您應該會看到：
```
📱 生成新的 webhook URL: https://ai-chatbot-umqm.onrender.com/api/webhook/line/{用戶ID}
📱 用戶 ID: {用戶ID}
```

## 故障排除

### 如果看不到「您的專屬端點」區塊
1. 確保您已經編譯並運行了最新版本的 app
2. 檢查 Xcode 控制台是否有錯誤信息
3. 嘗試重新啟動 app

### 如果 URL 沒有生成
1. 點擊「測試生成」按鈕
2. 檢查 Xcode 控制台的調試信息
3. 確保網路連線正常

### 如果後端 API 不可用
- 功能會自動使用本地模式
- 會生成臨時的用戶 ID
- URL 會保存在本地儲存中

## 功能特點

### ✅ 已實作的功能
- 動態用戶專屬 URL 生成
- 本地儲存支援
- 複製到剪貼簿
- 重新生成功能
- 錯誤處理
- 調試信息

### 🔄 自動化流程
1. 頁面載入時自動檢查本地儲存
2. 如果有已保存的 URL，直接顯示
3. 如果沒有，自動生成新的 URL
4. 保存到本地儲存

### 🛡️ 安全性
- 每個用戶都有獨立的 URL
- 基於用戶 ID 生成
- 本地儲存保護

## 下一步

### 1. 測試複製功能
- 點擊「複製」按鈕
- 檢查剪貼簿是否包含正確的 URL

### 2. 在 LINE Developers Console 測試
1. 複製生成的 URL
2. 登入 LINE Developers Console
3. 將 URL 貼到 Webhook URL 欄位
4. 測試連線

### 3. 後端整合
- 當後端 API 準備好時，功能會自動使用後端
- 目前使用本地模式確保功能正常運作

## 技術細節

### 本地儲存鍵值
- `currentUserId`: 保存用戶 ID
- `userWebhookURL`: 保存生成的 webhook URL

### 生成邏輯
1. 檢查本地是否有已保存的用戶 ID
2. 如果沒有，生成臨時 ID 或從後端獲取
3. 使用用戶 ID 生成專屬 webhook URL
4. 保存到本地儲存

### 錯誤處理
- 後端 API 失敗時使用本地模式
- 顯示適當的錯誤信息
- 保持功能可用性

這個功能現在應該可以正常運作了！請測試並告訴我結果如何。 